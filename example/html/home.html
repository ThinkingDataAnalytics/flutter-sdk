<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="origin" name="referrer">
        <title>Flutter测试</title>
        <!-- 添加脚本加载错误捕获 -->
        <script>
            (function() {
               var originalConsoleLog = console.log;
               console.log = function(message) {
                   // 保留原始功能
                   originalConsoleLog.apply(console, arguments);
                   // 发送到Flutter
                   if (window.ConsoleLog) {
                       window.ConsoleLog.postMessage(message);
                   }
               };
            })();
            window.onerror = function(message, source, lineno, colno, error) {
                const errorMsg = `JS错误: ${message} 在 ${source}:${lineno}:${colno}`;
                console.log(errorMsg); // 会被转发到Flutter
                return true;
            };
        </script>
        <script src="./thinkingdata.umd.min.js" onerror="console.log('thinkingdata.min.js加载失败')"></script>
        <script>
        var config = {
            appId: '40eddce753cd4bef9883a01e168c3df0',
            serverUrl: 'https://receiver-ta-preview.thinkingdata.cn',
            send_method: 'image',
            useAppTrack: true,
            autoTrack: {
                pageShow: true,
                pageHide: true,
            },
            imgUseCrossorigin:true
        };
        window.ta = thinkingdata;
        ta.init(config);

        function trackAction()
        {
            ta.track('h5test');
        }

        function  loginAction()
        {
            ta.login('h5login');
        }

        function logoutAction()
        {
            ta.logout();
        }

        function  usersetAction() {
            ta.userSet({email: 'xxx@xx'});
        }

        function  userSetOnceAction() {
            ta.userSetOnce({email: 'xxx@xx'});
        }

        function  userAddAction() {
            ta.userAdd({level: 4});
        }

        function  userDelAction() {
            ta.userDel();
        }

    function  userUnsetAction() {
        ta.userUnset("light_name");
    }

    function  userAppendAction() {
        ta.userAppend({ user_list: ["apple", "ball"] });
    }

    function  userUniqAppendAction() {
        ta.userUniqAppend({ user_list: ["apple", "cube"] });
    }

    function  setPagePropertyAction() {
        ta.setPageProperty({phone: '423'});
    }


    function trackFirstCheckID() {
        ta.trackFirstEvent({
            eventName: 'js_eventName_track_first_check_id',
            properties: {
                js_test_key: 'js_test_value'
            }
        });
    }

    function trackUpdate() {
        ta.trackUpdate({
            eventName: 'js_test_edit_event_name',
            eventId: 'js_test_edit_event_id',
            properties: {
                js_test_key: 'js_test_value_update',
                js_test_key2: 'js_test_value_update2'
            }
        });
    }

    function trackOverwrite() {
        ta.trackOverwrite({
            eventName: 'js_test_edit_event_name',
            eventId: 'js_test_edit_event_id',
            properties: {
                js_test_key: 'js_test_value_overwrite'
            }
        });
    }
        </script>
    </head>

<body>
<p>Hello world! This is HTML5 Demo.</p>
<button type="submit" id="track" onclick="trackAction()"> track </button>
<button type="submit" id="login" onclick="loginAction()"> loginAction </button>
<button type="submit" id="logout" onclick="logoutAction()"> logoutAction </button>
<button type="submit" id="userset" onclick="usersetAction()"> usersetAction </button>
<button type="submit" id="userSetOnce" onclick="userSetOnceAction()"> userSetOnceAction </button>
<button type="submit" id="userAdd" onclick="userAddAction()"> userAddAction </button>
<button type="submit" id="userDel" onclick="userDelAction()"> userDelAction </button>
<button type="submit" id="userUnset" onclick="userUnsetAction()"> userUnset </button>
<button type="submit" id="userAppend" onclick="userAppendAction()"> userAppend </button>
<button type="submit" id="userUniqAppend" onclick="userUniqAppendAction()"> userUniqAppend </button>
<button type="submit" id="setPageProperty" onclick="setPagePropertyAction()"> setPagePropertyAction </button>

<button type="submit" id="first_check_id" onclick="trackFirstCheckID()"> trackFirstCheckID </button>
<button type="submit" id="track_update" onclick="trackUpdate()"> trackUpdate </button>
<button type="submit" id="track_overwrite" onclick="trackOverwrite()"> trackOverwrite </button>
</body>

</html>